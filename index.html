<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Professional Address Manager</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 25px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
      color: #2d3748;
      margin-bottom: 25px;
      font-size: 28px;
      font-weight: 600;
    }

    /* Search Bar */
    .search-bar {
      width: 100%;
      padding: 12px 1px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    .view { display: none; }
    .view.active { display: block; }

    .address-card {
      background: #fff;
      margin-bottom: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .address-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    /* Editable Header Style */
    .address-header {
      font-size: 22px;
      font-weight: bold;
      padding: 15px;
      color: #fff;
      text-align: left;
      direction: ltr;
      cursor: text;
      background: linear-gradient(90deg, #FF9A8B 0%, #FF6A88 55%, #FF99AC 100%);
      transition: background 0.3s;
    }
    .address-header:focus {
      outline: 3px solid #4299e1;
      outline-offset: -3px;
    }

    .address-body {
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 25px;
    }

    .column { flex: 1; display: flex; flex-direction: column; gap: 15px; }
    .input-group { display: flex; flex-direction: column; }
    .input-label {
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 5px;
      padding-left: 3px;
    }

    .address-form input, .address-form textarea {
      width: 100%;
      padding: 14px;
      margin: 0;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
      min-height: 45px; 
    }
    .address-form textarea { min-height: 80px; }
    .address-form input:focus, .address-form textarea:focus {
      outline: none;
      border-color: #4299e1;
      box-shadow: 0 0 0 3px rgba(66,153,225,0.2);
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 15px 20px 0;
      margin-bottom: 10px;
    }
    .delete-btn {
      background: linear-gradient(to right, #FF416C, #FF4B2B);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    .delete-btn:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(255,65,108,0.4); }

    .action-bar {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      padding: 0 20px 20px;
    }
    .submit-btn {
      background: linear-gradient(to right, #2c3e50, #4a69bd);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(44,62,80,0.4); }

    .add-new-header-btn {
      background: linear-gradient(to right, #56ab2f, #a8e063);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .add-new-header-btn:hover { transform: scale(1.02); box-shadow: 0 4px 8px rgba(86,171,47,0.4); }

    #listView { padding: 10px 0; }
    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      margin-bottom: 10px;
      background: #f7f7f7;
      border-radius: 8px;
      border-left: 5px solid #4299e1;
      transition: background 0.2s;
    }
    .list-item:hover { background: #f0f0f0; }
    .list-info { flex-grow: 1; font-size: 16px; color: #2d3748; }
    .list-info strong { font-weight: 600; color: #1a202c; }
    .list-actions button { margin-left: 10px; }
    .view-btn {
      background: linear-gradient(to right, #4299e1, #63b3ed);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    .view-btn:hover { background: linear-gradient(to right, #3182ce, #4299e1); }

    .location-link {
      color: #3182ce;
      text-decoration: underline;
      cursor: pointer;
      font-weight: 500;
      padding: 8px 0;
      display: inline-block;
      transition: color 0.2s;
      margin-top: 5px;
    }
    .location-link:hover { color: #2c5aa0; }
  </style>
</head>
<body>
<div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
      <h2>üìç Professional Address Manager</h2>
      <button class="add-new-header-btn" onclick="showFormView()">‚ûï Add New Address</button>
  </div>

  <input type="text" id="searchInput" class="search-bar" placeholder="Search by name, phone, address, location..." oninput="applySearch()">

  <div id="formView" class="view active">
      <div id="addressContainer"></div>
  </div>
  
  <div id="listView" class="view"></div>
</div>

<script>
let addresses = JSON.parse(localStorage.getItem("addresses")) || [];
let activeAddressIndex = -1;

function saveData() { localStorage.setItem("addresses", JSON.stringify(addresses)); }

function showFormView(index=-1) {
  document.getElementById('formView').classList.add('active');
  document.getElementById('listView').classList.remove('active');

  if (index > -1) {
    activeAddressIndex = index;
    renderForm(addresses[index], index);
  } else {
    activeAddressIndex = addresses.length;
    const newAddress = { id: Date.now(), entity:"", contactName:"", email:"", phone:"", address1:"", address2:"", location:"New Location", comment:"", status:"draft"};
    addresses.push(newAddress);
    saveData();
    renderForm(newAddress, activeAddressIndex);
  }
}

function showListView() {
  document.getElementById('formView').classList.remove('active');
  document.getElementById('listView').classList.add('active');
  activeAddressIndex = -1;
  renderList();
}

function renderForm(address, index) {
  const container = document.getElementById("addressContainer");
  container.innerHTML = "";

  const card = document.createElement("div");
  card.className = "address-card";

  const header = document.createElement("div");
  header.className = "address-header";
  header.setAttribute("contenteditable","true");
  header.style.direction = "ltr";
  header.innerText = address.location || "New Location";
  const hue = (address.location.length * 137.5) % 360; 
  header.style.background = `linear-gradient(90deg, hsl(${hue},70%,65%), hsl(${hue+20},80%,55%))`;

  // Excel-style input update
  header.addEventListener('input', e => {
    addresses[index].location = e.target.innerText;
    saveData();
    const hue = (e.target.innerText.length * 137.5) % 360; 
    header.style.background = `linear-gradient(90deg, hsl(${hue},70%,65%), hsl(${hue+20},80%,55%))`;
  });
  card.appendChild(header);

  const topBar = document.createElement("div");
  topBar.className = "top-bar";
  const delBtn = document.createElement("button");
  delBtn.className = "delete-btn";
  delBtn.innerText = "Delete";
  delBtn.onclick = ()=>{ if(confirm("Are you sure you want to delete this address?")){ addresses.splice(index,1); saveData(); showListView(); } };
  topBar.appendChild(delBtn);
  card.appendChild(topBar);

  const body = document.createElement("div");
  body.className = "address-body address-form";

  body.innerHTML = `
    <div class="column">
      <div class="input-group"><div class="input-label">Client Name</div><input type="text" placeholder="Enter Client Name" value="${escapeHtml(address.entity||'')}" data-index="${index}" data-field="entity"></div>
      <div class="input-group"><div class="input-label">Client Email</div><input type="email" placeholder="Enter email" value="${escapeHtml(address.email||'')}" data-index="${index}" data-field="email"></div>
      <div class="input-group"><div class="input-label">Address Line 1</div><textarea placeholder="Enter primary address" data-index="${index}" data-field="address1">${escapeHtml(address.address1||'')}</textarea></div>
    </div>
    <div class="column">
      <div class="input-group"><div class="input-label">Customer Name</div><input type="text" placeholder="Customer Name" value="${escapeHtml(address.contactName||'')}" data-index="${index}" data-field="contactName"></div>
      <div class="input-group"><div class="input-label">Customer Contact No</div><input type="text" placeholder="Enter phone number" value="${escapeHtml(address.phone||'')}" data-index="${index}" data-field="phone"></div>
      <div class="input-group"><div class="input-label">Address Line 2 (paste link here)</div><textarea placeholder="Paste location link or additional info" data-index="${index}" data-field="address2">${escapeHtml(address.address2||'')}</textarea></div>
      <div class="input-group"><div class="input-label">Comments</div><textarea placeholder="Enter any additional comments" data-index="${index}" data-field="comment">${escapeHtml(address.comment||'')}</textarea></div>
    </div>
  `;
  card.appendChild(body);

  if(address.address2 && isUrl(address.address2)){
    const linkContainer = document.createElement("div");
    linkContainer.style.padding="0 20px 15px 20px";
    linkContainer.innerHTML=`<a class="location-link" href="${escapeHtml(address.address2)}" target="_blank">üåê Open Location Link</a>`;
    card.appendChild(linkContainer);
  }

  const actionBar=document.createElement("div");
  actionBar.className="action-bar";
  const submitBtn=document.createElement("button");
  submitBtn.className="submit-btn";
  submitBtn.innerText="‚úÖ Save & View List";
  submitBtn.onclick=()=>{ addresses[index].status='submitted'; saveData(); showListView(); };
  actionBar.appendChild(submitBtn);
  card.appendChild(actionBar);

  container.appendChild(card);
  attachInputEvents();
}

// Attach Excel-style input events without rerendering
function attachInputEvents(){
  const container=document.getElementById('addressContainer');
  container.querySelectorAll('input,textarea').forEach(inp=>{
    inp.oninput=e=>{
      const i=parseInt(inp.dataset.index);
      const field=inp.dataset.field;
      addresses[i][field]=e.target.value;
      saveData();
    };
    inp.onkeydown=e=>e.stopPropagation();
  });
}

function renderList(filtered=[]){
  const container=document.getElementById("listView");
  container.innerHTML="";
  const data=filtered.length>0 ? filtered : addresses.filter(a=>a.status==='submitted'||!a.status);
  if(data.length===0){ container.innerHTML=`<p style="text-align:center; padding:30px; color:#777;">No submitted addresses found.</p>`; return; }
  data.forEach(address=>{
    const originalIndex=addresses.findIndex(a=>a.id===address.id);
    const item=document.createElement("div");
    item.className="list-item";
    const info=document.createElement("div");
    info.className="list-info";
    info.innerHTML=`<strong>${escapeHtml(address.location||'N/A')}</strong> - ${escapeHtml(address.entity||'No Entity')} <span style="color:#888;">(${escapeHtml(address.contactName||'No Contact')})</span>`;
    const actions=document.createElement("div");
    actions.className="list-actions";
    const viewBtn=document.createElement("button");
    viewBtn.className="view-btn"; viewBtn.innerText="View/Edit"; viewBtn.onclick=()=>showFormView(originalIndex);
    const delBtn=document.createElement("button");
    delBtn.className="delete-btn"; delBtn.innerText="Delete"; delBtn.onclick=()=>{ if(confirm(`Delete ${address.location}?`)){ addresses.splice(originalIndex,1); saveData(); renderList(); } };
    actions.appendChild(viewBtn); actions.appendChild(delBtn);
    item.appendChild(info); item.appendChild(actions); container.appendChild(item);
  });
}

function escapeHtml(unsafe){ if(!unsafe) return ''; return unsafe.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"); }
function isUrl(str){ try{new URL(str); return true;}catch{return false;} }

function applySearch(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  if(!q){ renderList(); return; }
  const filtered=addresses.filter(a=>[a.location,a.entity,a.contactName,a.phone,a.address1,a.address2].some(f=>f&&f.toLowerCase().includes(q)));
  renderList(filtered);
}

if(addresses.filter(a=>a.status==='submitted'||!a.status).length>0) showListView();
else showFormView();
</script>
</body>
</html>
